<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавление перевала</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .error {
            color: red;
            font-size: 14px;
        }
        .success {
            color: green;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Добавить новый перевал</h1>

    <form id="perevalForm" enctype="multipart/form-data">
        <!-- Пользователь -->
        <fieldset>
            <legend>Данные пользователя</legend>
            <div class="form-group">
                <label for="email">Email*</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="fam">Фамилия*</label>
                <input type="text" id="fam" name="fam" required>
            </div>
            <div class="form-group">
                <label for="name">Имя*</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="otc">Отчество</label>
                <input type="text" id="otc" name="otc">
            </div>
            <div class="form-group">
                <label for="phone">Телефон*</label>
                <input type="tel" id="phone" name="phone" required>
            </div>
        </fieldset>

        <!-- Координаты -->
        <fieldset>
            <legend>Координаты</legend>
            <div class="form-group">
                <label for="latitude">Широта*</label>
                <input type="text" id="latitude" name="latitude" required>
            </div>
            <div class="form-group">
                <label for="longitude">Долгота*</label>
                <input type="text" id="longitude" name="longitude" required>
            </div>
            <div class="form-group">
                <label for="height">Высота*</label>
                <input type="number" id="height" name="height" required>
            </div>
        </fieldset>

        <!-- Данные перевала -->
        <fieldset>
            <legend>Информация о перевале</legend>
            <div class="form-group">
                <label for="beauty_title">Краткое название*</label>
                <input type="text" id="beauty_title" name="beauty_title" required>
            </div>
            <div class="form-group">
                <label for="title">Название*</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="other_titles">Другие названия</label>
                <input type="text" id="other_titles" name="other_titles">
            </div>
            <div class="form-group">
                <label for="connect">Соединение</label>
                <input type="text" id="connect" name="connect">
            </div>
        </fieldset>

        <!-- Уровень сложности -->
        <fieldset>
            <legend>Уровень сложности</legend>
            <div class="form-group">
                <label for="winter">Зима</label>
                <input type="text" id="winter" name="winter" placeholder="1A">
            </div>
            <div class="form-group">
                <label for="summer">Лето</label>
                <input type="text" id="summer" name="summer" placeholder="1A">
            </div>
            <div class="form-group">
                <label for="autumn">Осень</label>
                <input type="text" id="autumn" name="autumn" placeholder="1A">
            </div>
            <div class="form-group">
                <label for="spring">Весна</label>
                <input type="text" id="spring" name="spring" placeholder="1A">
            </div>
        </fieldset>

        <!-- Изображения -->
        <fieldset>
            <legend>Изображения</legend>
            <div class="form-group">
                <label for="image1" >Изображение 1*</label>
                <input type="file"  id="image1" name="image1" accept="image/*" required>
            </div>
            <div class="form-group">
                <label for="title1">Название изображения 1</label>
                <input type="text" id="title1" name="title1" placeholder="Вид с севера">
        </fieldset>

        <button type="submit">Отправить</button>
    </form>

    <div id="message"></div>

    <script>
        document.getElementById('perevalForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();

            formData.append('user.email', document.getElementById('email').value);
            formData.append('user.fam', document.getElementById('fam').value);
            formData.append('user.name', document.getElementById('name').value);
            formData.append('user.otc', document.getElementById('otc').value);
            formData.append('user.phone', document.getElementById('phone').value);

            formData.append('coords.latitude', document.getElementById('latitude').value);
            formData.append('coords.longitude', document.getElementById('longitude').value);
            formData.append('coords.height', document.getElementById('height').value);

            formData.append('beauty_title', document.getElementById('beauty_title').value);
            formData.append('title', document.getElementById('title').value);
            formData.append('other_titles', document.getElementById('other_titles').value);
            formData.append('connect', document.getElementById('connect').value);

            formData.append('level.winter', document.getElementById('winter').value || "1A");
            formData.append('level.summer', document.getElementById('summer').value || "1A");
            formData.append('level.autumn', document.getElementById('autumn').value || "1A");
            formData.append('level.spring', document.getElementById('spring').value || "1A");

            const image1 = document.getElementById('image1').files[0];
            if (image1) {
                formData.append('images.image', image1);
                formData.append('images.title', document.getElementById('title1').value || "Изображение 1");
            }

            const image2 = document.getElementById('image2').files[0];
            if (image2) {
                formData.append('images.image', image2);
                formData.append('images.title', document.getElementById('title2').value || "Изображение 2");
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/api/submitData/', {
                    method: 'POST',
                    body: formData,
                });

                const result = await response.json();

                if (response.ok) {
                    document.getElementById('message').innerHTML =
                        `<p class="success">Данные успешно отправлены! ID: ${result.id || 'успех'}</p>`;
                } else {
                    document.getElementById('message').innerHTML =
                        `<p class="error">Ошибка: ${result.detail || JSON.stringify(result)}</p>`;
                }
            } catch (error) {
                document.getElementById('message').innerHTML =
                    `<p class="error">Ошибка сети: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>