<!DOCTYPE html>
<html>
<head>
    <title>Добавление перевала</title>
</head>
<body>
    <h1>Добавить новый перевал</h1>

    <form method="post" enctype="multipart/form-data" id="perevalForm">
        {% csrf_token %}

        <!-- User Data -->
        <fieldset>
            <legend>Информация о пользователе</legend>
            <div>
                <label>Email:</label>
                <input type="email" name="user[email]" required>
            </div>
            <div>
                <label>Фамилия:</label>
                <input type="text" name="user[fam]" required>
            </div>
            <div>
                <label>Имя:</label>
                <input type="text" name="user[name]" required>
            </div>
            <div>
                <label>Отчество:</label>
                <input type="text" name="user[otc]">
            </div>
            <div>
                <label>Телефон:</label>
                <input type="tel" name="user[phone]">
            </div>
        </fieldset>

        <!-- Coordinates -->
        <fieldset>
            <legend>Координаты</legend>
            <div>
                <label>Широта:</label>
                <input type="number" step="0.000001" name="coords[latitude]">
            </div>
            <div>
                <label>Долгота:</label>
                <input type="number" step="0.000001" name="coords[longitude]">
            </div>
            <div>
                <label>Высота:</label>
                <input type="number" name="coords[height]">
            </div>
        </fieldset>

        <!-- Pereval Info -->
        <fieldset>
            <legend>Информация о перевале</legend>
            <div>
                <label>Красивое название:</label>
                <input type="text" name="beauty_title">
            </div>
            <div>
                <label>Название:</label>
                <input type="text" name="title" required>
            </div>
            <div>
                <label>Другие названия:</label>
                <input type="text" name="other_titles">
            </div>
            <div>
                <label>Соединение:</label>
                <input type="text" name="connect">
            </div>
        </fieldset>

        <!-- Levels -->
        <fieldset>
            <legend>Уровни сложности</legend>
            <div>
                <label>Зима:</label>
                <input type="text" name="level[winter]">
            </div>
            <div>
                <label>Лето:</label>
                <input type="text" name="level[summer]">
            </div>
            <div>
                <label>Осень:</label>
                <input type="text" name="level[autumn]">
            </div>
            <div>
                <label>Весна:</label>
                <input type="text" name="level[spring]">
            </div>
        </fieldset>

        <!-- Images -->
        <fieldset>
            <legend>Фотографии</legend>
            <div>
                <label>Загрузить фотографии:</label>
                <input type="file" name="images" multiple accept="image/*">
            </div>
        </fieldset>

        <button type="submit">Отправить</button>
    </form>

    <script>
        document.getElementById('perevalForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData();

            // Собираем данные формы
            const formElements = e.target.elements;

            // User data
            formData.append('user[email]', formElements['user[email]'].value);
            formData.append('user[fam]', formElements['user[fam]'].value);
            formData.append('user[name]', formElements['user[name]'].value);
            formData.append('user[otc]', formElements['user[otc]'].value);
            formData.append('user[phone]', formElements['user[phone]'].value);

            // Coordinates
            formData.append('coords[latitude]', formElements['coords[latitude]'].value);
            formData.append('coords[longitude]', formElements['coords[longitude]'].value);
            formData.append('coords[height]', formElements['coords[height]'].value);

            // Pereval info
            formData.append('beauty_title', formElements['beauty_title'].value);
            formData.append('title', formElements['title'].value);
            formData.append('other_titles', formElements['other_titles'].value);
            formData.append('connect', formElements['connect'].value);

            // Levels
            formData.append('level[winter]', formElements['level[winter]'].value);
            formData.append('level[summer]', formElements['level[summer]'].value);
            formData.append('level[autumn]', formElements['level[autumn]'].value);
            formData.append('level[spring]', formElements['level[spring]'].value);

            // Images
            const imageFiles = formElements['images'].files;
            for (let i = 0; i < imageFiles.length; i++) {
                formData.append('images', imageFiles[i]);
            }

            // CSRF токен
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            try {
                const response = await fetch('/submitData/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken
                    },
                    body: formData
                });

                const result = await response.json();
                console.log('Success:', result);
                alert('Данные успешно отправлены! ID: ' + (result.id || ''));
            } catch (error) {
                console.error('Error:', error);
                alert('Ошибка при отправке: ' + error.message);
            }
        });
    </script>
</body>
</html>